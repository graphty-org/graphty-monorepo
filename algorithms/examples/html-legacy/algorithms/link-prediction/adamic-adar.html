<!doctype html>
<html lang="en">
    <head>
        <!-- MANDATORY: Eruda Mobile Console (exact code) -->
        <script src="https://cdn.jsdelivr.net/npm/eruda@3/eruda.min.js"></script>
        <script>
            if (typeof eruda !== "undefined") {
                eruda.init();
                if (/mobile|android|ios|iphone|ipad|ipod/i.test(navigator.userAgent.toLowerCase())) {
                    eruda.show();
                }
            }
        </script>

        <meta charset="UTF-8" />
        <meta name="viewport" content="width=device-width, initial-scale=1.0" />
        <title>Adamic-Adar Index - Simple Visual Explanation</title>
        <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/prism/1.29.0/themes/prism.min.css" />
        <style>
            /* MANDATORY STYLES - DO NOT MODIFY */
            body {
                font-family: -apple-system, BlinkMacSystemFont, "Segoe UI", Roboto, sans-serif;
                max-width: 800px;
                margin: 0 auto;
                padding: 20px;
                background: #f5f5f5; /* Light gray background */
            }

            h1 {
                color: #2c5aa0; /* Blue header */
                text-align: center;
            }

            .container {
                background: white;
                border-radius: 8px;
                padding: 30px;
                box-shadow: 0 2px 4px rgba(0, 0, 0, 0.1);
            }

            #graph {
                width: 100%;
                height: 400px;
                border: 2px solid #e0e0e0;
                border-radius: 8px;
                margin: 20px 0;
            }

            button {
                background: #4caf50; /* Green button */
                color: white;
                border: none;
                padding: 12px 24px;
                font-size: 16px;
                border-radius: 6px;
                cursor: pointer;
            }

            .explanation {
                background: #e8f0fe;
                border-left: 4px solid #2c5aa0;
                padding: 15px;
                margin: 20px 0;
                border-radius: 4px;
            }

            /* Additional algorithm-specific styles */
            .back-link {
                text-decoration: none;
                color: #2c5aa0;
                display: inline-block;
                margin-bottom: 20px;
                font-weight: 500;
            }

            .back-link:hover {
                text-decoration: underline;
            }

            .intro {
                margin-bottom: 20px;
            }

            .intro p {
                margin: 10px 0;
                line-height: 1.6;
            }

            .intro strong {
                color: #333;
            }

            .prediction-info {
                display: flex;
                justify-content: space-around;
                margin: 20px 0;
                background: #f8f9fa;
                padding: 15px;
                border-radius: 6px;
                flex-wrap: wrap;
                gap: 20px;
            }

            .prediction-stat {
                text-align: center;
                flex: 1;
                min-width: 120px;
            }

            .prediction-stat .value {
                font-size: 24px;
                font-weight: bold;
                color: #2c5aa0;
            }

            .prediction-stat .label {
                font-size: 12px;
                color: #666;
                margin-top: 5px;
            }

            .step-info {
                margin: 20px 0;
                padding: 15px;
                background: #f0f7ff;
                border-radius: 6px;
                font-size: 16px;
                text-align: center;
            }

            .legend {
                display: flex;
                gap: 20px;
                flex-wrap: wrap;
                margin-top: 15px;
                padding: 10px;
                background: #f8f9fa;
                border-radius: 6px;
            }

            .legend-item {
                display: flex;
                align-items: center;
                gap: 8px;
            }

            .legend-color {
                width: 20px;
                height: 20px;
                border-radius: 50%;
                border: 2px solid #333;
            }

            button:hover {
                background: #45a049;
            }

            button:disabled {
                background: #ccc;
                cursor: not-allowed;
            }

            .controls {
                text-align: center;
                margin: 20px 0;
            }

            .algorithm-settings {
                display: flex;
                gap: 20px;
                margin: 20px 0;
                flex-wrap: wrap;
                justify-content: center;
            }

            .setting-group {
                display: flex;
                flex-direction: column;
                gap: 5px;
                align-items: center;
            }

            .setting-group label {
                font-size: 14px;
                color: #666;
            }

            .setting-group input[type="range"] {
                width: 120px;
            }

            .setting-group span {
                font-weight: bold;
                color: #2c5aa0;
                font-size: 12px;
            }

            .explanation h3 {
                color: #2c5aa0;
                margin-top: 0;
            }

            .code-section {
                margin-top: 30px;
                border-top: 1px solid #e0e0e0;
                padding-top: 20px;
            }

            .code-header {
                display: flex;
                justify-content: space-between;
                align-items: center;
                margin-bottom: 15px;
            }

            .code-header h3 {
                margin: 0;
                color: #2c5aa0;
            }

            .code-toggle {
                background: none;
                border: 1px solid #2c5aa0;
                color: #2c5aa0;
                padding: 6px 12px;
                font-size: 14px;
                cursor: pointer;
                border-radius: 4px;
            }

            .code-toggle:hover {
                background: #2c5aa0;
                color: white;
            }

            .code-content {
                background: #f8f9fa;
                border-radius: 6px;
                overflow: hidden;
                transition: max-height 0.3s ease;
            }

            .code-content.collapsed {
                max-height: 0;
            }

            pre {
                margin: 0;
                overflow-x: auto;
            }

            text {
                font-family: -apple-system, BlinkMacSystemFont, "Segoe UI", Roboto, sans-serif;
            }

            /* Node selection states */
            .node-normal {
                fill: #e0e0e0;
                stroke: #333;
                stroke-width: 2;
            }
            .node-selected {
                fill: #ff6b6b;
                stroke: #333;
                stroke-width: 3;
            }
            .node-target {
                fill: #4ecdc4;
                stroke: #333;
                stroke-width: 3;
            }
            .node-common {
                fill: #f9ca24;
                stroke: #333;
                stroke-width: 3;
            }
            .node-predicted {
                fill: #45b7d1;
                stroke: #333;
                stroke-width: 3;
            }

            /* Node rarity indication */
            .node-rare {
                fill: #e74c3c;
                stroke: #c0392b;
                stroke-width: 4;
            }
            .node-common-neighbor {
                fill: #f39c12;
                stroke: #d68910;
                stroke-width: 3;
            }

            /* Edge states */
            .edge-normal {
                stroke: #ccc;
                stroke-width: 2;
            }
            .edge-to-common {
                stroke: #f39c12;
                stroke-width: 3;
            }
            .edge-rare-connection {
                stroke: #e74c3c;
                stroke-width: 4;
            }
            .edge-predicted {
                stroke: #e74c3c;
                stroke-width: 3;
                stroke-dasharray: 5, 5;
            }

            /* Hover effects */
            .node-hover {
                filter: drop-shadow(0 0 8px rgba(44, 90, 160, 0.5));
                cursor: pointer;
            }

            .prediction-list {
                background: #fff3cd;
                border-radius: 6px;
                padding: 15px;
                margin: 15px 0;
                border: 1px solid #ffeaa7;
            }

            .prediction-item {
                display: flex;
                justify-content: space-between;
                align-items: center;
                padding: 8px 0;
                border-bottom: 1px solid #e8e8e8;
            }

            .prediction-item:last-child {
                border-bottom: none;
            }

            .prediction-score {
                font-weight: bold;
                color: #2c5aa0;
                background: #e8f0fe;
                padding: 4px 8px;
                border-radius: 4px;
                font-size: 14px;
            }

            .node-info {
                background: #f8f9fa;
                border-radius: 6px;
                padding: 10px;
                margin: 10px 0;
                font-size: 14px;
                text-align: center;
            }

            .weight-explanation {
                background: #fff8e1;
                border: 1px solid #ffcc02;
                border-radius: 6px;
                padding: 10px;
                margin: 10px 0;
                font-size: 14px;
            }

            .weight-item {
                display: flex;
                justify-content: space-between;
                margin: 5px 0;
                padding: 3px 6px;
                background: white;
                border-radius: 3px;
            }

            .degree-indicator {
                position: absolute;
                background: rgba(0, 0, 0, 0.8);
                color: white;
                padding: 2px 6px;
                border-radius: 10px;
                font-size: 10px;
                font-weight: bold;
                transform: translate(-50%, -120%);
                pointer-events: none;
            }
        </style>
    </head>
    <body>
        <a href="../../index.html" class="back-link">← Back to Examples</a>

        <h1>Adamic-Adar Index Explained</h1>

        <div class="container">
            <div class="intro">
                <p><strong>Like finding influential mutual friends - rare connections matter more!</strong></p>
                <p>
                    Adamic-Adar Index is a weighted version of Common Neighbors that gives higher importance to rare
                    mutual connections. A mutual friend with few connections is more valuable than one with many
                    connections.
                </p>
            </div>

            <svg id="graph"></svg>

            <div class="prediction-info">
                <div class="prediction-stat">
                    <div class="value" id="selected-nodes">0/2</div>
                    <div class="label">Nodes Selected</div>
                </div>
                <div class="prediction-stat">
                    <div class="value" id="common-count">0</div>
                    <div class="label">Common Neighbors</div>
                </div>
                <div class="prediction-stat">
                    <div class="value" id="aa-score">0.00</div>
                    <div class="label">Adamic-Adar Score</div>
                </div>
                <div class="prediction-stat">
                    <div class="value" id="total-predictions">0</div>
                    <div class="label">Total Predictions</div>
                </div>
            </div>

            <div class="weight-explanation" id="weight-explanation" style="display: none">
                <strong>Weight Calculation:</strong><br />
                Each common neighbor contributes: 1 / log(degree)<br />
                <div id="weight-details"></div>
            </div>

            <div class="node-info" id="node-info" style="display: none">
                Click on two nodes to see their Adamic-Adar score and weighted common neighbors
            </div>

            <div class="prediction-list" id="prediction-list" style="display: none">
                <h4>Top Link Predictions (Adamic-Adar):</h4>
                <div id="predictions-content"></div>
            </div>

            <div class="step-info" id="step-info">
                Click "Start" to see all predictions, or click two nodes to compare their weighted similarity
            </div>

            <div class="legend">
                <div class="legend-item">
                    <div class="legend-color" style="background: #ff6b6b"></div>
                    <span>Selected Node</span>
                </div>
                <div class="legend-item">
                    <div class="legend-color" style="background: #4ecdc4"></div>
                    <span>Target Node</span>
                </div>
                <div class="legend-item">
                    <div class="legend-color" style="background: #f39c12"></div>
                    <span>Common Neighbor</span>
                </div>
                <div class="legend-item">
                    <div class="legend-color" style="background: #e74c3c"></div>
                    <span>Rare/Influential Node</span>
                </div>
            </div>

            <div class="algorithm-settings">
                <div class="setting-group">
                    <label for="top-k">Top Predictions</label>
                    <input type="range" id="top-k" min="3" max="10" value="5" step="1" />
                    <span id="top-k-value">5</span>
                </div>
                <div class="setting-group">
                    <label for="animation-speed">Animation Speed</label>
                    <input type="range" id="animation-speed" min="500" max="3000" value="1500" step="100" />
                    <span id="speed-value">1.5s</span>
                </div>
            </div>

            <div class="controls">
                <button id="start-btn" onclick="startAlgorithm()">Show All Predictions</button>
                <button id="reset-btn" onclick="resetVisualization()">Reset Selection</button>
            </div>

            <div class="explanation">
                <h3>Key Concept:</h3>
                <p>Adamic-Adar Index improves on Common Neighbors by weighting each mutual connection:</p>
                <p><strong>AA(A, B) = Σ (1 / log(degree(z)))</strong> for all common neighbors z</p>
                <p>
                    A mutual friend with 2 connections contributes more than one with 20 connections. This captures the
                    intuition that rare, exclusive connections are more meaningful for predicting future links!
                </p>
                <p>
                    Applications: Social networks (close mutual friends), academic collaboration (specialized fields),
                    professional networks (niche expertise).
                </p>
            </div>

            <div class="code-section">
                <div class="code-header">
                    <h3>Code Example</h3>
                    <button class="code-toggle" id="code-toggle">Hide Code ▲</button>
                </div>
                <div class="code-content" id="code-content">
                    <pre><code class="language-javascript" id="code-display">Loading code...</code></pre>
                </div>
            </div>
        </div>

        <script src="https://cdnjs.cloudflare.com/ajax/libs/prism/1.29.0/prism.min.js"></script>
        <script src="https://cdnjs.cloudflare.com/ajax/libs/prism/1.29.0/components/prism-javascript.min.js"></script>

        <script type="module">
            // Import the algorithm functions
            import { Graph } from "./algorithms.js";
            import { adamicAdarScore, adamicAdarPrediction } from "./algorithms.js";

            // Load and display the actual code
            async function loadCodeExample() {
                try {
                    const response = await fetch("./adamic-adar.js");
                    const code = await response.text();
                    document.getElementById("code-display").textContent = code;
                    Prism.highlightElement(document.getElementById("code-display"));
                } catch (error) {
                    document.getElementById("code-display").textContent =
                        `import { Graph, adamicAdarScore, adamicAdarPrediction } from '@graphty/algorithms';

// Create a network with varying node degrees
const graph = new Graph();

// Add people with different social connectivity levels
['Alice', 'Bob', 'Carol', 'Dave', 'Eve', 'Frank', 'Grace', 'Henry'].forEach(person => {
    graph.addNode(person);
});

// Add connections - some nodes have many, others few
const connections = [
    // Alice: well-connected (hub)
    ['Alice', 'Bob'], ['Alice', 'Carol'], ['Alice', 'Dave'], ['Alice', 'Eve'],
    
    // Bob: moderately connected  
    ['Bob', 'Frank'], ['Bob', 'Grace'],
    
    // Carol: selective connections (rare/valuable)
    ['Carol', 'Henry'],
    
    // Others
    ['Dave', 'Frank'], ['Eve', 'Grace'], ['Frank', 'Henry']
];

connections.forEach(([person1, person2]) => {
    graph.addEdge(person1, person2);
});

// Predict links using Adamic-Adar Index
const predictions = adamicAdarPrediction(graph, {
    includeExisting: false,
    topK: 5
});

console.log('Top Adamic-Adar predictions:');
predictions.forEach(pred => {
    console.log(\`\${pred.source} ↔ \${pred.target}: \${pred.score.toFixed(3)} (weighted)\`);
});

// Compare with specific pair
const score = adamicAdarScore(graph, 'Bob', 'Henry');
console.log(\`Bob-Henry Adamic-Adar score: \${score.toFixed(3)}\`);`;
                    Prism.highlightElement(document.getElementById("code-display"));
                }
            }

            // Graph structure with varying degrees to show Adamic-Adar advantage
            const nodes = [
                { id: "Alice", x: 200, y: 150 }, // Hub - high degree
                { id: "Bob", x: 100, y: 100 }, // Medium degree
                { id: "Carol", x: 300, y: 100 }, // Low degree (selective)
                { id: "Dave", x: 150, y: 250 }, // Medium degree
                { id: "Eve", x: 350, y: 200 }, // Low degree (rare)
                { id: "Frank", x: 100, y: 300 }, // Medium degree
                { id: "Grace", x: 400, y: 300 }, // Low degree
                { id: "Henry", x: 250, y: 350 }, // Very low degree (exclusive)
            ];

            const edges = [
                // Alice as hub (high degree = lower individual weight)
                { source: "Alice", target: "Bob" },
                { source: "Alice", target: "Carol" },
                { source: "Alice", target: "Dave" },
                { source: "Alice", target: "Eve" },

                // Medium degree nodes
                { source: "Bob", target: "Frank" },
                { source: "Dave", target: "Frank" },

                // Low degree nodes (high individual weights)
                { source: "Carol", target: "Henry" },
                { source: "Eve", target: "Grace" },
                { source: "Frank", target: "Grace" },
                { source: "Grace", target: "Henry" },
            ];

            // Create graph for algorithm
            function createGraph() {
                const graph = new Graph();

                // Add nodes
                nodes.forEach((node) => graph.addNode(node.id));

                // Add edges
                edges.forEach((edge) => graph.addEdge(edge.source, edge.target));

                return graph;
            }

            // Animation state
            let isAnimating = false;
            let selectedNodes = [];
            let animationSpeed = 1500;
            let allPredictions = [];
            let nodeDegrees = new Map();

            // Calculate node degrees
            function calculateDegrees() {
                const graph = createGraph();
                nodeDegrees.clear();
                nodes.forEach((node) => {
                    nodeDegrees.set(node.id, graph.degree(node.id));
                });
            }

            // Initialize graph visualization
            function initGraph() {
                const svg = document.getElementById("graph");

                // Clear existing content
                svg.innerHTML = "";

                calculateDegrees();

                // Draw edges
                edges.forEach((edge, index) => {
                    const sourceNode = nodes.find((n) => n.id === edge.source);
                    const targetNode = nodes.find((n) => n.id === edge.target);

                    const line = document.createElementNS("http://www.w3.org/2000/svg", "line");
                    line.setAttribute("x1", sourceNode.x);
                    line.setAttribute("y1", sourceNode.y);
                    line.setAttribute("x2", targetNode.x);
                    line.setAttribute("y2", targetNode.y);
                    line.setAttribute("class", "edge-normal");
                    line.setAttribute("id", `edge-${index}`);
                    svg.appendChild(line);
                });

                // Draw nodes with degree indicators
                nodes.forEach((node, index) => {
                    const g = document.createElementNS("http://www.w3.org/2000/svg", "g");

                    const circle = document.createElementNS("http://www.w3.org/2000/svg", "circle");
                    circle.setAttribute("cx", node.x);
                    circle.setAttribute("cy", node.y);
                    circle.setAttribute("r", "25");
                    circle.setAttribute("class", "node-normal");
                    circle.setAttribute("id", `node-${node.id}`);

                    // Add click handler
                    circle.addEventListener("click", () => selectNode(node.id));
                    circle.addEventListener("mouseenter", () => circle.classList.add("node-hover"));
                    circle.addEventListener("mouseleave", () => circle.classList.remove("node-hover"));

                    const text = document.createElementNS("http://www.w3.org/2000/svg", "text");
                    text.setAttribute("x", node.x);
                    text.setAttribute("y", node.y + 5);
                    text.setAttribute("text-anchor", "middle");
                    text.setAttribute("font-size", "11");
                    text.setAttribute("font-weight", "bold");
                    text.textContent = node.id;

                    // Add degree indicator
                    const degree = nodeDegrees.get(node.id) || 0;
                    const degreeText = document.createElementNS("http://www.w3.org/2000/svg", "text");
                    degreeText.setAttribute("x", node.x);
                    degreeText.setAttribute("y", node.y - 35);
                    degreeText.setAttribute("text-anchor", "middle");
                    degreeText.setAttribute("font-size", "10");
                    degreeText.setAttribute("font-weight", "bold");
                    degreeText.setAttribute("fill", "#666");
                    degreeText.textContent = `d=${degree}`;
                    degreeText.setAttribute("id", `degree-${node.id}`);

                    g.appendChild(circle);
                    g.appendChild(text);
                    g.appendChild(degreeText);
                    svg.appendChild(g);
                });

                // Initialize UI
                updateSettings();
                loadCodeExample();

                // Code toggle functionality
                document.getElementById("code-toggle").addEventListener("click", function () {
                    const codeContent = document.getElementById("code-content");
                    const toggle = document.getElementById("code-toggle");

                    if (codeContent.classList.contains("collapsed")) {
                        codeContent.classList.remove("collapsed");
                        codeContent.style.maxHeight = codeContent.scrollHeight + "px";
                        toggle.textContent = "Hide Code ▲";
                    } else {
                        codeContent.classList.add("collapsed");
                        codeContent.style.maxHeight = "0";
                        toggle.textContent = "Show Code ▼";
                    }
                });

                // Initially show code
                const codeContent = document.getElementById("code-content");
                codeContent.style.maxHeight = codeContent.scrollHeight + "px";
            }

            // Update settings displays
            function updateSettings() {
                const topK = document.getElementById("top-k").value;
                const speed = document.getElementById("animation-speed").value;

                document.getElementById("top-k-value").textContent = topK;
                document.getElementById("speed-value").textContent = (speed / 1000).toFixed(1) + "s";
                animationSpeed = parseInt(speed);
            }

            // Event listeners for settings
            document.getElementById("top-k").addEventListener("input", updateSettings);
            document.getElementById("animation-speed").addEventListener("input", updateSettings);

            // Node selection logic
            function selectNode(nodeId) {
                if (selectedNodes.includes(nodeId)) {
                    return; // Already selected
                }

                if (selectedNodes.length >= 2) {
                    // Reset and start fresh
                    resetVisualization();
                }

                selectedNodes.push(nodeId);

                // Update visual state
                const circle = document.getElementById(`node-${nodeId}`);
                if (selectedNodes.length === 1) {
                    circle.setAttribute("class", "node-selected");
                } else {
                    circle.setAttribute("class", "node-target");
                }

                // Update info
                document.getElementById("selected-nodes").textContent = `${selectedNodes.length}/2`;

                if (selectedNodes.length === 2) {
                    showAdamicAdarAnalysis(selectedNodes[0], selectedNodes[1]);
                } else {
                    document.getElementById("node-info").style.display = "block";
                    document.getElementById("node-info").textContent =
                        `Selected ${nodeId} (degree: ${nodeDegrees.get(nodeId)}). Click another node to see Adamic-Adar score.`;
                }
            }

            // Show Adamic-Adar analysis between two nodes
            function showAdamicAdarAnalysis(node1, node2) {
                const graph = createGraph();
                const aaScore = adamicAdarScore(graph, node1, node2);

                // Find common neighbors and calculate individual contributions
                const neighbors1 = new Set(graph.neighbors(node1));
                const neighbors2 = new Set(graph.neighbors(node2));
                const commonNeighbors = [...neighbors1].filter((n) => neighbors2.has(n));

                // Calculate weights for each common neighbor
                const weightDetails = commonNeighbors.map((neighbor) => {
                    const degree = graph.degree(neighbor);
                    const weight = degree > 1 ? 1 / Math.log(degree) : 1;
                    return { neighbor, degree, weight };
                });

                // Update stats
                document.getElementById("common-count").textContent = commonNeighbors.length;
                document.getElementById("aa-score").textContent = aaScore.toFixed(3);

                // Highlight common neighbors with different colors based on rarity
                commonNeighbors.forEach((nodeId) => {
                    const circle = document.getElementById(`node-${nodeId}`);
                    const degree = nodeDegrees.get(nodeId) || 0;
                    // Color nodes by rarity (low degree = more rare/valuable)
                    if (degree <= 2) {
                        circle.setAttribute("class", "node-rare");
                    } else {
                        circle.setAttribute("class", "node-common-neighbor");
                    }
                });

                // Highlight edges to common neighbors
                edges.forEach((edge, index) => {
                    const edgeElement = document.getElementById(`edge-${index}`);
                    if (
                        (edge.source === node1 || edge.target === node1) &&
                        (commonNeighbors.includes(edge.source) || commonNeighbors.includes(edge.target))
                    ) {
                        const neighborId = edge.source === node1 ? edge.target : edge.source;
                        const degree = nodeDegrees.get(neighborId) || 0;
                        if (degree <= 2) {
                            edgeElement.setAttribute("class", "edge-rare-connection");
                        } else {
                            edgeElement.setAttribute("class", "edge-to-common");
                        }
                    } else if (
                        (edge.source === node2 || edge.target === node2) &&
                        (commonNeighbors.includes(edge.source) || commonNeighbors.includes(edge.target))
                    ) {
                        const neighborId = edge.source === node2 ? edge.target : edge.source;
                        const degree = nodeDegrees.get(neighborId) || 0;
                        if (degree <= 2) {
                            edgeElement.setAttribute("class", "edge-rare-connection");
                        } else {
                            edgeElement.setAttribute("class", "edge-to-common");
                        }
                    }
                });

                // Show weight calculation details
                if (weightDetails.length > 0) {
                    document.getElementById("weight-explanation").style.display = "block";
                    const detailsDiv = document.getElementById("weight-details");
                    detailsDiv.innerHTML = weightDetails
                        .map(
                            (item) =>
                                `<div class="weight-item">
                        <span>${item.neighbor} (degree: ${item.degree})</span>
                        <span>1/log(${item.degree}) = ${item.weight.toFixed(3)}</span>
                    </div>`,
                        )
                        .join("");
                }

                // Update info display
                document.getElementById("node-info").style.display = "block";
                document.getElementById("node-info").innerHTML =
                    `<strong>${node1}</strong> and <strong>${node2}</strong><br>
                Common neighbors: ${commonNeighbors.length}<br>
                Adamic-Adar score: <strong>${aaScore.toFixed(3)}</strong><br>
                ${aaScore > 0 ? "Rare connections (red) contribute more weight!" : "No common neighbors"}`;

                // Check if they're already connected
                const isConnected = graph.hasEdge(node1, node2);
                if (!isConnected && aaScore > 0) {
                    // Draw predicted edge
                    const sourceNode = nodes.find((n) => n.id === node1);
                    const targetNode = nodes.find((n) => n.id === node2);

                    const svg = document.getElementById("graph");
                    const line = document.createElementNS("http://www.w3.org/2000/svg", "line");
                    line.setAttribute("x1", sourceNode.x);
                    line.setAttribute("y1", sourceNode.y);
                    line.setAttribute("x2", targetNode.x);
                    line.setAttribute("y2", targetNode.y);
                    line.setAttribute("class", "edge-predicted");
                    line.setAttribute("id", "predicted-edge");
                    svg.appendChild(line);
                }
            }

            // Reset visualization
            window.resetVisualization = function () {
                selectedNodes = [];

                // Reset node colors
                nodes.forEach((node) => {
                    const circle = document.getElementById(`node-${node.id}`);
                    circle.setAttribute("class", "node-normal");
                });

                // Reset edge colors
                edges.forEach((edge, index) => {
                    const edgeElement = document.getElementById(`edge-${index}`);
                    edgeElement.setAttribute("class", "edge-normal");
                });

                // Remove predicted edge
                const predictedEdge = document.getElementById("predicted-edge");
                if (predictedEdge) {
                    predictedEdge.remove();
                }

                // Reset displays
                document.getElementById("selected-nodes").textContent = "0/2";
                document.getElementById("common-count").textContent = "0";
                document.getElementById("aa-score").textContent = "0.00";
                document.getElementById("node-info").style.display = "none";
                document.getElementById("weight-explanation").style.display = "none";
                document.getElementById("prediction-list").style.display = "none";
                document.getElementById("step-info").textContent =
                    'Click two nodes to see their Adamic-Adar score, or "Show All Predictions" for full analysis';
            };

            // Show all predictions
            window.startAlgorithm = async function () {
                if (isAnimating) return;

                const button = document.getElementById("start-btn");
                button.disabled = true;
                button.textContent = "Computing...";
                isAnimating = true;

                try {
                    resetVisualization();

                    const graph = createGraph();
                    const topK = parseInt(document.getElementById("top-k").value);

                    // Get all predictions
                    allPredictions = adamicAdarPrediction(graph, {
                        includeExisting: false,
                        topK: topK,
                    });

                    document.getElementById("total-predictions").textContent = allPredictions.length;

                    // Display predictions
                    const predictionsContent = document.getElementById("predictions-content");
                    predictionsContent.innerHTML = "";

                    allPredictions.forEach((pred, index) => {
                        const predItem = document.createElement("div");
                        predItem.className = "prediction-item";
                        predItem.innerHTML = `
                        <span><strong>${pred.source}</strong> ↔ <strong>${pred.target}</strong></span>
                        <span class="prediction-score">${pred.score.toFixed(3)}</span>
                    `;
                        predictionsContent.appendChild(predItem);
                    });

                    document.getElementById("prediction-list").style.display = "block";
                    document.getElementById("step-info").textContent =
                        `Found ${allPredictions.length} potential links. Rare connections (low degree nodes) boost scores significantly!`;

                    // Console output
                    const result = adamicAdarPrediction(graph, { includeExisting: false });
                    console.log("Adamic-Adar Predictions:", result);
                } finally {
                    button.disabled = false;
                    button.textContent = "Show All Predictions";
                    isAnimating = false;
                }
            };

            // Initialize on load
            window.onload = initGraph;
        </script>
    </body>
</html>
