<!doctype html>
<html lang="en">
    <head>
        <!-- MANDATORY: Eruda Mobile Console (exact code) -->
        <script src="https://cdn.jsdelivr.net/npm/eruda@3/eruda.min.js"></script>
        <script>
            if (typeof eruda !== "undefined") {
                eruda.init();
                if (/mobile|android|ios|iphone|ipad|ipod/i.test(navigator.userAgent.toLowerCase())) {
                    eruda.show();
                }
            }
        </script>

        <meta charset="UTF-8" />
        <meta name="viewport" content="width=device-width, initial-scale=1.0" />
        <title>Graph Isomorphism - Simple Visual Explanation</title>
        <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/prism/1.29.0/themes/prism.min.css" />
        <style>
            /* MANDATORY STYLES - DO NOT MODIFY */
            body {
                font-family: -apple-system, BlinkMacSystemFont, "Segoe UI", Roboto, sans-serif;
                max-width: 800px;
                margin: 0 auto;
                padding: 20px;
                background: #f5f5f5; /* Light gray background */
            }

            h1 {
                color: #2c5aa0; /* Blue header */
                text-align: center;
            }

            .container {
                background: white;
                border-radius: 8px;
                padding: 30px;
                box-shadow: 0 2px 4px rgba(0, 0, 0, 0.1);
            }

            #graph {
                width: 100%;
                height: 400px;
                border: 2px solid #e0e0e0;
                border-radius: 8px;
                margin: 20px 0;
            }

            button {
                background: #4caf50; /* Green button */
                color: white;
                border: none;
                padding: 12px 24px;
                font-size: 16px;
                border-radius: 6px;
                cursor: pointer;
            }

            .explanation {
                background: #e8f0fe;
                border-left: 4px solid #2c5aa0;
                padding: 15px;
                margin: 20px 0;
                border-radius: 4px;
            }

            /* Additional algorithm-specific styles */
            .back-link {
                text-decoration: none;
                color: #2c5aa0;
                display: inline-block;
                margin-bottom: 20px;
                font-weight: 500;
            }

            .back-link:hover {
                text-decoration: underline;
            }

            .intro {
                margin-bottom: 20px;
            }

            .intro p {
                margin: 10px 0;
                line-height: 1.6;
            }

            .intro strong {
                color: #333;
            }

            .isomorphism-info {
                display: flex;
                justify-content: space-around;
                margin: 20px 0;
                background: #f8f9fa;
                padding: 15px;
                border-radius: 6px;
                flex-wrap: wrap;
                gap: 20px;
            }

            .isomorphism-stat {
                text-align: center;
                flex: 1;
                min-width: 120px;
            }

            .isomorphism-stat .value {
                font-size: 24px;
                font-weight: bold;
                color: #2c5aa0;
            }

            .isomorphism-stat .label {
                font-size: 12px;
                color: #666;
                margin-top: 5px;
            }

            .step-info {
                margin: 20px 0;
                padding: 15px;
                background: #f0f7ff;
                border-radius: 6px;
                font-size: 16px;
                text-align: center;
            }

            .legend {
                display: flex;
                gap: 20px;
                flex-wrap: wrap;
                margin-top: 15px;
                padding: 10px;
                background: #f8f9fa;
                border-radius: 6px;
            }

            .legend-item {
                display: flex;
                align-items: center;
                gap: 8px;
            }

            .legend-color {
                width: 20px;
                height: 20px;
                border-radius: 50%;
                border: 2px solid #333;
            }

            button:hover {
                background: #45a049;
            }

            button:disabled {
                background: #ccc;
                cursor: not-allowed;
            }

            .controls {
                text-align: center;
                margin: 20px 0;
            }

            .graph-container {
                display: flex;
                gap: 20px;
                margin: 20px 0;
            }

            .graph-side {
                flex: 1;
                text-align: center;
            }

            .graph-side h3 {
                color: #2c5aa0;
                margin-bottom: 10px;
            }

            .graph-svg {
                width: 100%;
                height: 250px;
                border: 2px solid #e0e0e0;
                border-radius: 8px;
                background: white;
            }

            .algorithm-settings {
                display: flex;
                gap: 20px;
                margin: 20px 0;
                flex-wrap: wrap;
                justify-content: center;
            }

            .setting-group {
                display: flex;
                flex-direction: column;
                gap: 5px;
                align-items: center;
            }

            .setting-group label {
                font-size: 14px;
                color: #666;
            }

            .setting-group select {
                padding: 5px 10px;
                border: 1px solid #ddd;
                border-radius: 4px;
            }

            .setting-group input[type="range"] {
                width: 120px;
            }

            .setting-group span {
                font-weight: bold;
                color: #2c5aa0;
                font-size: 12px;
            }

            .explanation h3 {
                color: #2c5aa0;
                margin-top: 0;
            }

            .code-section {
                margin-top: 30px;
                border-top: 1px solid #e0e0e0;
                padding-top: 20px;
            }

            .code-header {
                display: flex;
                justify-content: space-between;
                align-items: center;
                margin-bottom: 15px;
            }

            .code-header h3 {
                margin: 0;
                color: #2c5aa0;
            }

            .code-toggle {
                background: none;
                border: 1px solid #2c5aa0;
                color: #2c5aa0;
                padding: 6px 12px;
                font-size: 14px;
                cursor: pointer;
                border-radius: 4px;
            }

            .code-toggle:hover {
                background: #2c5aa0;
                color: white;
            }

            .code-content {
                background: #f8f9fa;
                border-radius: 6px;
                overflow: hidden;
                transition: max-height 0.3s ease;
            }

            .code-content.collapsed {
                max-height: 0;
            }

            pre {
                margin: 0;
                overflow-x: auto;
            }

            text {
                font-family: -apple-system, BlinkMacSystemFont, "Segoe UI", Roboto, sans-serif;
            }

            /* Isomorphism-specific styles */
            .node-unvisited {
                fill: #e0e0e0;
                stroke: #666;
                stroke-width: 2;
            }

            .node-mapped {
                fill: #4caf50;
                stroke: #2e7d32;
                stroke-width: 3;
            }

            .node-exploring {
                fill: #ff9800;
                stroke: #f57c00;
                stroke-width: 3;
            }

            .node-candidate {
                fill: #2196f3;
                stroke: #1976d2;
                stroke-width: 3;
            }

            .node-rejected {
                fill: #f44336;
                stroke: #d32f2f;
                stroke-width: 3;
            }

            .edge-normal {
                stroke: #ccc;
                stroke-width: 2;
            }

            .edge-mapped {
                stroke: #4caf50;
                stroke-width: 4;
            }

            .edge-exploring {
                stroke: #ff9800;
                stroke-width: 3;
                stroke-dasharray: 5, 5;
            }

            /* Mapping indicator */
            .mapping-line {
                stroke: #9c27b0;
                stroke-width: 3;
                stroke-dasharray: 10, 5;
                opacity: 0.7;
            }

            @keyframes pulse {
                0% {
                    opacity: 1;
                }
                50% {
                    opacity: 0.5;
                }
                100% {
                    opacity: 1;
                }
            }

            .pulsing {
                animation: pulse 1s infinite;
            }

            .result-display {
                background: #e8f5e8;
                border: 1px solid #4caf50;
                border-radius: 6px;
                padding: 15px;
                margin: 15px 0;
                display: none;
            }

            .result-display.show {
                display: block;
            }

            .result-display.negative {
                background: #ffebee;
                border-color: #f44336;
            }

            .mapping-display {
                background: #fff3e0;
                border: 1px solid #ff9800;
                border-radius: 6px;
                padding: 15px;
                margin: 15px 0;
                display: none;
            }

            .mapping-display.show {
                display: block;
            }

            .mapping-item {
                display: flex;
                justify-content: space-between;
                align-items: center;
                padding: 5px 0;
                border-bottom: 1px solid #ddd;
            }

            .mapping-item:last-child {
                border-bottom: none;
            }

            .mapping-arrow {
                color: #9c27b0;
                font-weight: bold;
                font-size: 18px;
            }

            .scenario-selector {
                background: #fff3cd;
                border: 1px solid #ffeaa7;
                border-radius: 6px;
                padding: 15px;
                margin: 15px 0;
            }

            .scenario-buttons {
                display: flex;
                gap: 10px;
                flex-wrap: wrap;
                justify-content: center;
                margin-top: 10px;
            }

            .scenario-button {
                background: #2c5aa0;
                color: white;
                border: none;
                padding: 8px 16px;
                font-size: 14px;
                border-radius: 4px;
                cursor: pointer;
            }

            .scenario-button:hover {
                background: #1976d2;
            }

            .scenario-button.active {
                background: #4caf50;
            }

            .comparison-grid {
                display: grid;
                grid-template-columns: 1fr 1fr;
                gap: 20px;
                margin: 20px 0;
            }

            @media (max-width: 600px) {
                .comparison-grid {
                    grid-template-columns: 1fr;
                }
            }
        </style>
    </head>
    <body>
        <a href="../../index.html" class="back-link">← Back to Examples</a>

        <h1>Graph Isomorphism Explained</h1>

        <div class="container">
            <div class="intro">
                <p><strong>Like comparing building blueprints - same structure, different labels!</strong></p>
                <p>
                    Graph Isomorphism determines if two graphs have identical structure. Two graphs are isomorphic if
                    you can relabel the nodes of one graph to perfectly match the other graph's connections.
                </p>
            </div>

            <div class="scenario-selector">
                <strong>Choose Test Scenario:</strong>
                <div class="scenario-buttons">
                    <button class="scenario-button active" onclick="loadScenario('isomorphic')">
                        Isomorphic Graphs
                    </button>
                    <button class="scenario-button" onclick="loadScenario('non-isomorphic')">Non-Isomorphic</button>
                    <button class="scenario-button" onclick="loadScenario('similar')">Similar but Different</button>
                    <button class="scenario-button" onclick="loadScenario('automorphism')">Graph Automorphism</button>
                </div>
            </div>

            <div class="comparison-grid">
                <div class="graph-side">
                    <h3>Graph A</h3>
                    <svg id="graph-a" class="graph-svg"></svg>
                </div>
                <div class="graph-side">
                    <h3>Graph B</h3>
                    <svg id="graph-b" class="graph-svg"></svg>
                </div>
            </div>

            <div class="isomorphism-info">
                <div class="isomorphism-stat">
                    <div class="value" id="nodes-a">0</div>
                    <div class="label">Nodes A</div>
                </div>
                <div class="isomorphism-stat">
                    <div class="value" id="nodes-b">0</div>
                    <div class="label">Nodes B</div>
                </div>
                <div class="isomorphism-stat">
                    <div class="value" id="edges-a">0</div>
                    <div class="label">Edges A</div>
                </div>
                <div class="isomorphism-stat">
                    <div class="value" id="edges-b">0</div>
                    <div class="label">Edges B</div>
                </div>
                <div class="isomorphism-stat">
                    <div class="value" id="result-status">?</div>
                    <div class="label">Isomorphic</div>
                </div>
            </div>

            <div class="result-display" id="result-display">
                <h4 id="result-title">Isomorphism Result</h4>
                <div id="result-content"></div>
            </div>

            <div class="mapping-display" id="mapping-display">
                <h4>Node Mapping (Graph A → Graph B):</h4>
                <div id="mapping-list"></div>
            </div>

            <div class="step-info" id="step-info">
                Click "Check Isomorphism" to test if the graphs have identical structure
            </div>

            <div class="legend">
                <div class="legend-item">
                    <div class="legend-color" style="background: #e0e0e0"></div>
                    <span>Unvisited</span>
                </div>
                <div class="legend-item">
                    <div class="legend-color" style="background: #ff9800"></div>
                    <span>Exploring</span>
                </div>
                <div class="legend-item">
                    <div class="legend-color" style="background: #2196f3"></div>
                    <span>Candidate</span>
                </div>
                <div class="legend-item">
                    <div class="legend-color" style="background: #4caf50"></div>
                    <span>Mapped</span>
                </div>
                <div class="legend-item">
                    <div class="legend-color" style="background: #f44336"></div>
                    <span>Rejected</span>
                </div>
            </div>

            <div class="algorithm-settings">
                <div class="setting-group">
                    <label for="algorithm-mode">Algorithm Mode</label>
                    <select id="algorithm-mode">
                        <option value="check">Check Isomorphism</option>
                        <option value="find-all">Find All Mappings</option>
                    </select>
                </div>
                <div class="setting-group">
                    <label for="animation-speed">Animation Speed</label>
                    <input type="range" id="animation-speed" min="500" max="3000" value="1500" step="100" />
                    <span id="speed-value">1.5s</span>
                </div>
            </div>

            <div class="controls">
                <button id="start-btn" onclick="startAlgorithm()">Check Isomorphism</button>
                <button id="reset-btn" onclick="resetVisualization()">Reset</button>
            </div>

            <div class="explanation">
                <h3>Key Concept:</h3>
                <p>
                    Graph Isomorphism uses the <strong>VF2 algorithm</strong> to systematically test all possible node
                    mappings:
                </p>
                <p><strong>1. Initial checks:</strong> Same number of nodes, edges, and degree sequence</p>
                <p><strong>2. Recursive mapping:</strong> Try to map each node while preserving all connections</p>
                <p><strong>3. Backtracking:</strong> If a mapping fails, try different combinations</p>
                <p>
                    Two graphs are isomorphic if there exists a bijection (one-to-one mapping) between their nodes that
                    preserves all edge relationships. This is a fundamental problem in graph theory with applications in
                    chemistry, pattern recognition, and network analysis!
                </p>
            </div>

            <div class="code-section">
                <div class="code-header">
                    <h3>Code Example</h3>
                    <button class="code-toggle" id="code-toggle">Hide Code ▲</button>
                </div>
                <div class="code-content" id="code-content">
                    <pre><code class="language-javascript" id="code-display">Loading code...</code></pre>
                </div>
            </div>
        </div>

        <script src="https://cdnjs.cloudflare.com/ajax/libs/prism/1.29.0/prism.min.js"></script>
        <script src="https://cdnjs.cloudflare.com/ajax/libs/prism/1.29.0/components/prism-javascript.min.js"></script>

        <script type="module">
            // Import the algorithm functions
            import { Graph } from "./algorithms.js";
            import { isGraphIsomorphic, findAllIsomorphisms } from "./algorithms.js";

            // Load and display the actual code
            async function loadCodeExample() {
                try {
                    const response = await fetch("./isomorphism.js");
                    const code = await response.text();
                    document.getElementById("code-display").textContent = code;
                    Prism.highlightElement(document.getElementById("code-display"));
                } catch (error) {
                    document.getElementById("code-display").textContent =
                        `import { Graph, isGraphIsomorphic, findAllIsomorphisms } from '@graphty/algorithms';

// Create two potentially isomorphic graphs
const graphA = new Graph();
const graphB = new Graph();

// Graph A: Triangle with additional node
graphA.addNode('1'); graphA.addNode('2'); 
graphA.addNode('3'); graphA.addNode('4');
graphA.addEdge('1', '2'); graphA.addEdge('2', '3'); 
graphA.addEdge('3', '1'); graphA.addEdge('1', '4');

// Graph B: Same structure, different labels
graphB.addNode('A'); graphB.addNode('B'); 
graphB.addNode('C'); graphB.addNode('D');
graphB.addEdge('A', 'B'); graphB.addEdge('B', 'C'); 
graphB.addEdge('C', 'A'); graphB.addEdge('A', 'D');

// Check if they are isomorphic
const result = isGraphIsomorphic(graphA, graphB);
console.log('Are graphs isomorphic?', result.isIsomorphic);

if (result.mapping) {
    console.log('Node mapping:');
    result.mapping.forEach((nodeB, nodeA) => {
        console.log(\`\${nodeA} → \${nodeB}\`);
    });
}

// Find all possible mappings
const allMappings = findAllIsomorphisms(graphA, graphB);
console.log(\`Found \${allMappings.length} isomorphic mappings\`);`;
                    Prism.highlightElement(document.getElementById("code-display"));
                }
            }

            // Test scenarios
            const scenarios = {
                isomorphic: {
                    name: "Isomorphic Graphs",
                    graphA: {
                        nodes: ["1", "2", "3", "4"],
                        edges: [
                            ["1", "2"],
                            ["2", "3"],
                            ["3", "1"],
                            ["1", "4"],
                        ],
                        positions: [
                            { x: 100, y: 50 },
                            { x: 50, y: 120 },
                            { x: 150, y: 120 },
                            { x: 100, y: 180 },
                        ],
                    },
                    graphB: {
                        nodes: ["A", "B", "C", "D"],
                        edges: [
                            ["A", "B"],
                            ["B", "C"],
                            ["C", "A"],
                            ["A", "D"],
                        ],
                        positions: [
                            { x: 100, y: 180 },
                            { x: 150, y: 120 },
                            { x: 50, y: 120 },
                            { x: 100, y: 50 },
                        ],
                    },
                    expectedResult: true,
                },
                "non-isomorphic": {
                    name: "Non-Isomorphic Graphs",
                    graphA: {
                        nodes: ["1", "2", "3", "4"],
                        edges: [
                            ["1", "2"],
                            ["2", "3"],
                            ["3", "4"],
                            ["4", "1"],
                        ],
                        positions: [
                            { x: 70, y: 70 },
                            { x: 130, y: 70 },
                            { x: 130, y: 130 },
                            { x: 70, y: 130 },
                        ],
                    },
                    graphB: {
                        nodes: ["A", "B", "C", "D"],
                        edges: [
                            ["A", "B"],
                            ["B", "C"],
                            ["C", "D"],
                            ["D", "A"],
                            ["A", "C"],
                        ],
                        positions: [
                            { x: 70, y: 70 },
                            { x: 130, y: 70 },
                            { x: 130, y: 130 },
                            { x: 70, y: 130 },
                        ],
                    },
                    expectedResult: false,
                },
                similar: {
                    name: "Similar but Different",
                    graphA: {
                        nodes: ["1", "2", "3", "4", "5"],
                        edges: [
                            ["1", "2"],
                            ["2", "3"],
                            ["3", "4"],
                            ["4", "5"],
                        ],
                        positions: [
                            { x: 50, y: 100 },
                            { x: 90, y: 60 },
                            { x: 130, y: 100 },
                            { x: 90, y: 140 },
                            { x: 170, y: 100 },
                        ],
                    },
                    graphB: {
                        nodes: ["A", "B", "C", "D", "E"],
                        edges: [
                            ["A", "B"],
                            ["B", "C"],
                            ["C", "D"],
                            ["D", "E"],
                            ["E", "A"],
                        ],
                        positions: [
                            { x: 50, y: 100 },
                            { x: 90, y: 60 },
                            { x: 130, y: 100 },
                            { x: 90, y: 140 },
                            { x: 170, y: 100 },
                        ],
                    },
                    expectedResult: false,
                },
                automorphism: {
                    name: "Graph Automorphism",
                    graphA: {
                        nodes: ["1", "2", "3", "4"],
                        edges: [
                            ["1", "2"],
                            ["2", "3"],
                            ["3", "4"],
                            ["4", "1"],
                            ["1", "3"],
                        ],
                        positions: [
                            { x: 70, y: 70 },
                            { x: 130, y: 70 },
                            { x: 130, y: 130 },
                            { x: 70, y: 130 },
                        ],
                    },
                    graphB: {
                        nodes: ["1", "2", "3", "4"],
                        edges: [
                            ["1", "2"],
                            ["2", "3"],
                            ["3", "4"],
                            ["4", "1"],
                            ["1", "3"],
                        ],
                        positions: [
                            { x: 70, y: 70 },
                            { x: 130, y: 70 },
                            { x: 130, y: 130 },
                            { x: 70, y: 130 },
                        ],
                    },
                    expectedResult: true,
                },
            };

            // Current state
            let currentScenario = "isomorphic";
            let isAnimating = false;
            let animationSpeed = 1500;
            let currentMapping = new Map();

            // Load scenario
            window.loadScenario = function (scenarioName) {
                if (isAnimating) return;

                currentScenario = scenarioName;

                // Update button states
                document.querySelectorAll(".scenario-button").forEach((btn) => {
                    btn.classList.remove("active");
                });
                event.target.classList.add("active");

                // Reset and reload
                resetVisualization();
                initGraphs();
            };

            // Create graphs for current scenario
            function createGraphs() {
                const scenario = scenarios[currentScenario];

                const graphA = new Graph();
                const graphB = new Graph();

                // Add nodes and edges for graph A
                scenario.graphA.nodes.forEach((node) => graphA.addNode(node));
                scenario.graphA.edges.forEach(([source, target]) => graphA.addEdge(source, target));

                // Add nodes and edges for graph B
                scenario.graphB.nodes.forEach((node) => graphB.addNode(node));
                scenario.graphB.edges.forEach(([source, target]) => graphB.addEdge(source, target));

                return { graphA, graphB };
            }

            // Draw a single graph
            function drawGraph(svg, graphData, graphObj) {
                // Clear existing content
                svg.innerHTML = "";

                // Draw edges first
                graphData.edges.forEach(([source, target], index) => {
                    const sourcePos = graphData.positions[graphData.nodes.indexOf(source)];
                    const targetPos = graphData.positions[graphData.nodes.indexOf(target)];

                    const line = document.createElementNS("http://www.w3.org/2000/svg", "line");
                    line.setAttribute("x1", sourcePos.x);
                    line.setAttribute("y1", sourcePos.y);
                    line.setAttribute("x2", targetPos.x);
                    line.setAttribute("y2", targetPos.y);
                    line.setAttribute("class", "edge-normal");
                    line.setAttribute("id", `edge-${svg.id}-${source}-${target}`);
                    svg.appendChild(line);
                });

                // Draw nodes
                graphData.nodes.forEach((node, index) => {
                    const pos = graphData.positions[index];
                    const g = document.createElementNS("http://www.w3.org/2000/svg", "g");

                    const circle = document.createElementNS("http://www.w3.org/2000/svg", "circle");
                    circle.setAttribute("cx", pos.x);
                    circle.setAttribute("cy", pos.y);
                    circle.setAttribute("r", "20");
                    circle.setAttribute("class", "node-unvisited");
                    circle.setAttribute("id", `node-${svg.id}-${node}`);

                    const text = document.createElementNS("http://www.w3.org/2000/svg", "text");
                    text.setAttribute("x", pos.x);
                    text.setAttribute("y", pos.y + 5);
                    text.setAttribute("text-anchor", "middle");
                    text.setAttribute("font-size", "14");
                    text.setAttribute("font-weight", "bold");
                    text.textContent = node;

                    g.appendChild(circle);
                    g.appendChild(text);
                    svg.appendChild(g);
                });
            }

            // Initialize graph visualization
            function initGraphs() {
                const scenario = scenarios[currentScenario];
                const { graphA, graphB } = createGraphs();

                const svgA = document.getElementById("graph-a");
                const svgB = document.getElementById("graph-b");

                drawGraph(svgA, scenario.graphA, graphA);
                drawGraph(svgB, scenario.graphB, graphB);

                // Update stats
                document.getElementById("nodes-a").textContent = scenario.graphA.nodes.length;
                document.getElementById("nodes-b").textContent = scenario.graphB.nodes.length;
                document.getElementById("edges-a").textContent = scenario.graphA.edges.length;
                document.getElementById("edges-b").textContent = scenario.graphB.edges.length;
                document.getElementById("result-status").textContent = "?";

                // Initialize UI
                updateSettings();
                loadCodeExample();

                // Code toggle functionality
                document.getElementById("code-toggle").addEventListener("click", function () {
                    const codeContent = document.getElementById("code-content");
                    const toggle = document.getElementById("code-toggle");

                    if (codeContent.classList.contains("collapsed")) {
                        codeContent.classList.remove("collapsed");
                        codeContent.style.maxHeight = codeContent.scrollHeight + "px";
                        toggle.textContent = "Hide Code ▲";
                    } else {
                        codeContent.classList.add("collapsed");
                        codeContent.style.maxHeight = "0";
                        toggle.textContent = "Show Code ▼";
                    }
                });

                // Initially show code
                const codeContent = document.getElementById("code-content");
                codeContent.style.maxHeight = codeContent.scrollHeight + "px";
            }

            // Update settings displays
            function updateSettings() {
                const speed = document.getElementById("animation-speed").value;
                document.getElementById("speed-value").textContent = (speed / 1000).toFixed(1) + "s";
                animationSpeed = parseInt(speed);
            }

            // Event listeners for settings
            document.getElementById("animation-speed").addEventListener("input", updateSettings);

            // Animate isomorphism checking
            async function animateIsomorphismCheck() {
                const scenario = scenarios[currentScenario];
                const { graphA, graphB } = createGraphs();

                // Step 1: Initial checks
                document.getElementById("step-info").textContent =
                    "Step 1: Checking basic properties (nodes, edges, degrees)...";
                await new Promise((resolve) => setTimeout(resolve, animationSpeed));

                if (scenario.graphA.nodes.length !== scenario.graphB.nodes.length) {
                    document.getElementById("step-info").textContent = "Different number of nodes - not isomorphic!";
                    return false;
                }

                if (scenario.graphA.edges.length !== scenario.graphB.edges.length) {
                    document.getElementById("step-info").textContent = "Different number of edges - not isomorphic!";
                    return false;
                }

                // Step 2: Degree sequence check
                document.getElementById("step-info").textContent = "Step 2: Comparing degree sequences...";
                await new Promise((resolve) => setTimeout(resolve, animationSpeed));

                const degreesA = scenario.graphA.nodes.map((node) => graphA.degree(node)).sort((a, b) => a - b);
                const degreesB = scenario.graphB.nodes.map((node) => graphB.degree(node)).sort((a, b) => a - b);

                for (let i = 0; i < degreesA.length; i++) {
                    if (degreesA[i] !== degreesB[i]) {
                        document.getElementById("step-info").textContent =
                            "Different degree sequences - not isomorphic!";
                        return false;
                    }
                }

                // Step 3: VF2 algorithm simulation
                document.getElementById("step-info").textContent =
                    "Step 3: Running VF2 algorithm to find node mapping...";
                await new Promise((resolve) => setTimeout(resolve, animationSpeed));

                // Simulate the mapping process with visual feedback
                const findAllMode = document.getElementById("algorithm-mode").value === "find-all";

                if (findAllMode) {
                    const allMappings = findAllIsomorphisms(graphA, graphB);

                    if (allMappings.length > 0) {
                        document.getElementById("step-info").textContent =
                            `Found ${allMappings.length} possible mappings...`;

                        // Show first mapping with animation
                        await animateMapping(allMappings[0], scenario);
                        return { isIsomorphic: true, mapping: allMappings[0], allMappings };
                    } else {
                        document.getElementById("step-info").textContent = "No valid mappings found - not isomorphic!";
                        return { isIsomorphic: false };
                    }
                } else {
                    const result = isGraphIsomorphic(graphA, graphB);

                    if (result.isIsomorphic && result.mapping) {
                        document.getElementById("step-info").textContent =
                            "Found valid mapping - graphs are isomorphic!";
                        await animateMapping(result.mapping, scenario);
                        return result;
                    } else {
                        document.getElementById("step-info").textContent = "No valid mapping found - not isomorphic!";
                        return result;
                    }
                }
            }

            // Animate the mapping between nodes
            async function animateMapping(mapping, scenario) {
                // Highlight mapped pairs
                for (const [nodeA, nodeB] of mapping.entries()) {
                    const nodeAElement = document.getElementById(`node-graph-a-${nodeA}`);
                    const nodeBElement = document.getElementById(`node-graph-b-${nodeB}`);

                    if (nodeAElement && nodeBElement) {
                        nodeAElement.classList.add("node-mapped", "pulsing");
                        nodeBElement.classList.add("node-mapped", "pulsing");
                    }

                    await new Promise((resolve) => setTimeout(resolve, animationSpeed / 3));
                }

                // Remove pulsing effect
                setTimeout(() => {
                    mapping.forEach((nodeB, nodeA) => {
                        const nodeAElement = document.getElementById(`node-graph-a-${nodeA}`);
                        const nodeBElement = document.getElementById(`node-graph-b-${nodeB}`);
                        if (nodeAElement) nodeAElement.classList.remove("pulsing");
                        if (nodeBElement) nodeBElement.classList.remove("pulsing");
                    });
                }, animationSpeed);
            }

            // Display results
            function displayResults(result) {
                const resultDisplay = document.getElementById("result-display");
                const resultTitle = document.getElementById("result-title");
                const resultContent = document.getElementById("result-content");

                document.getElementById("result-status").textContent = result.isIsomorphic ? "Yes" : "No";

                if (result.isIsomorphic) {
                    resultDisplay.classList.remove("negative");
                    resultDisplay.classList.add("show");
                    resultTitle.textContent = "Graphs are Isomorphic! ✓";

                    if (result.allMappings && result.allMappings.length > 1) {
                        resultContent.innerHTML = `
                        <p>Found <strong>${result.allMappings.length}</strong> different ways to map the nodes.</p>
                        <p>This means the graphs have some symmetry - multiple valid mappings exist.</p>
                    `;
                    } else {
                        resultContent.innerHTML = `
                        <p>The graphs have identical structure with different node labels.</p>
                        <p>One unique mapping preserves all edge relationships.</p>
                    `;
                    }

                    // Show mapping
                    if (result.mapping) {
                        const mappingDisplay = document.getElementById("mapping-display");
                        const mappingList = document.getElementById("mapping-list");

                        mappingList.innerHTML = "";
                        result.mapping.forEach((nodeB, nodeA) => {
                            const item = document.createElement("div");
                            item.className = "mapping-item";
                            item.innerHTML = `
                            <span><strong>${nodeA}</strong></span>
                            <span class="mapping-arrow">→</span>
                            <span><strong>${nodeB}</strong></span>
                        `;
                            mappingList.appendChild(item);
                        });

                        mappingDisplay.classList.add("show");
                    }
                } else {
                    resultDisplay.classList.add("negative");
                    resultDisplay.classList.add("show");
                    resultTitle.textContent = "Graphs are NOT Isomorphic ✗";
                    resultContent.innerHTML = `
                    <p>The graphs have different structures that cannot be matched.</p>
                    <p>No valid node mapping exists that preserves all edge relationships.</p>
                `;
                }
            }

            // Reset visualization
            window.resetVisualization = function () {
                if (isAnimating) return;

                const scenario = scenarios[currentScenario];

                // Reset node colors
                [...scenario.graphA.nodes, ...scenario.graphB.nodes].forEach((node) => {
                    const nodeAElement = document.getElementById(`node-graph-a-${node}`);
                    const nodeBElement = document.getElementById(`node-graph-b-${node}`);

                    if (nodeAElement) {
                        nodeAElement.classList.remove(
                            "node-mapped",
                            "node-exploring",
                            "node-candidate",
                            "node-rejected",
                            "pulsing",
                        );
                        nodeAElement.classList.add("node-unvisited");
                    }
                    if (nodeBElement) {
                        nodeBElement.classList.remove(
                            "node-mapped",
                            "node-exploring",
                            "node-candidate",
                            "node-rejected",
                            "pulsing",
                        );
                        nodeBElement.classList.add("node-unvisited");
                    }
                });

                // Reset edge colors
                [...scenario.graphA.edges, ...scenario.graphB.edges].forEach(([source, target]) => {
                    const edgeAElement = document.getElementById(`edge-graph-a-${source}-${target}`);
                    const edgeBElement = document.getElementById(`edge-graph-b-${source}-${target}`);

                    if (edgeAElement) {
                        edgeAElement.classList.remove("edge-mapped", "edge-exploring");
                        edgeAElement.classList.add("edge-normal");
                    }
                    if (edgeBElement) {
                        edgeBElement.classList.remove("edge-mapped", "edge-exploring");
                        edgeBElement.classList.add("edge-normal");
                    }
                });

                // Reset displays
                document.getElementById("result-status").textContent = "?";
                document.getElementById("result-display").classList.remove("show");
                document.getElementById("mapping-display").classList.remove("show");
                document.getElementById("step-info").textContent =
                    'Click "Check Isomorphism" to test if the graphs have identical structure';
            };

            // Start algorithm
            window.startAlgorithm = async function () {
                if (isAnimating) return;

                const button = document.getElementById("start-btn");
                button.disabled = true;
                button.textContent = "Checking...";
                isAnimating = true;

                try {
                    resetVisualization();

                    // Run actual algorithm for console output
                    const { graphA, graphB } = createGraphs();
                    const findAllMode = document.getElementById("algorithm-mode").value === "find-all";

                    if (findAllMode) {
                        const allMappings = findAllIsomorphisms(graphA, graphB);
                        console.log("All Isomorphisms:", allMappings);

                        const result = {
                            isIsomorphic: allMappings.length > 0,
                            mapping: allMappings[0],
                            allMappings: allMappings,
                        };

                        // Animate the algorithm
                        const animResult = await animateIsomorphismCheck();
                        displayResults(animResult || result);
                    } else {
                        const result = isGraphIsomorphic(graphA, graphB);
                        console.log("Isomorphism Result:", result);

                        // Animate the algorithm
                        const animResult = await animateIsomorphismCheck();
                        displayResults(animResult || result);
                    }
                } finally {
                    button.disabled = false;
                    button.textContent = "Check Isomorphism";
                    isAnimating = false;
                }
            };

            // Initialize on load
            window.onload = initGraphs;
        </script>
    </body>
</html>
