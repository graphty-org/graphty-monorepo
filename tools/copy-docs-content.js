#!/usr/bin/env node
// THIS FILE IS AUTO GENERATED: DO NOT EDIT THIS FILE DIRECTLY
// This script copies documentation content from package docs folders to the centralized docs folder

import { cpSync, rmSync, mkdirSync, existsSync } from "node:fs";
import { join, dirname } from "node:path";
import { fileURLToPath } from "node:url";

const __dirname = dirname(fileURLToPath(import.meta.url));
const rootDir = join(__dirname, "..");
const docsDir = join(rootDir, "docs");

// Mapping of source package docs to destination folders
const contentMap = [
    {
        src: "graphty-element/docs",
        dest: "graphty-element",
        exclude: [".vitepress"],
    },
    {
        src: "algorithms/docs",
        dest: "algorithms",
        exclude: [".vitepress"],
    },
    {
        src: "layout/docs",
        dest: "layout",
        exclude: [".vitepress"],
    },
];

// Ensure docs directory structure exists
if (!existsSync(docsDir)) {
    mkdirSync(docsDir, { recursive: true });
}

// Ensure .vitepress directory exists (don't delete it)
const vitepressDir = join(docsDir, ".vitepress");
if (!existsSync(vitepressDir)) {
    mkdirSync(vitepressDir, { recursive: true });
}

for (const { src, dest, exclude } of contentMap) {
    const srcPath = join(rootDir, src);
    const destPath = join(docsDir, dest);

    if (!existsSync(srcPath)) {
        console.warn(`Warning: Source path ${srcPath} does not exist, skipping`);
        continue;
    }

    // Clean destination (but preserve api/generated which is created by typedoc)
    if (existsSync(destPath)) {
        // Remove everything except api/generated
        const items = ["guide", "index.md", "api/index.md"];
        for (const item of items) {
            const itemPath = join(destPath, item);
            if (existsSync(itemPath)) {
                rmSync(itemPath, { recursive: true, force: true });
            }
        }
    }

    // Create destination directory
    mkdirSync(destPath, { recursive: true });

    // Copy content, excluding specified directories
    cpSync(srcPath, destPath, {
        recursive: true,
        filter: (src) => {
            for (const ex of exclude) {
                if (src.includes(ex)) {
                    return false;
                }
            }
            return true;
        },
    });

    console.log(`Copied ${src} -> docs/${dest}`);
}

console.log("Documentation content copied successfully");
